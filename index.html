<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polar Beacons: NunaNet Corporate Console</title>
    <!-- Tailwind CSS CDN for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <!-- Lucide Icons (Inline SVG replacement) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Global Styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* slate-900 */
            color: #f8fafc; /* slate-50 */
            scroll-behavior: smooth;
        }

        /* Custom Scrollbar for a sleek look */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b; /* slate-800 */
        }
        ::-webkit-scrollbar-thumb {
            background: #06b6d4; /* cyan-500 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #0891b2; /* cyan-600 */
        }

        /* Hero Section Animation */
        @keyframes aurora-gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .hero-aurora {
            background: linear-gradient(-45deg, #0f172a, #083344, #06b6d4, #0f172a);
            background-size: 400% 400%;
            animation: aurora-gradient 15s ease infinite;
        }

        /* Card Hover Effect */
        .card-glow {
            transition: all 0.3s ease;
        }
        .card-glow:hover {
            box-shadow: 0 0 30px rgba(6, 182, 212, 0.4); /* Cyan glow */
            transform: translateY(-5px);
        }

        /* Console Table Styling */
        .console-table th {
            @apply p-4 text-left text-sm font-semibold uppercase tracking-wider bg-slate-800 text-gray-400 border-b border-slate-700;
        }
        .console-table td {
            @apply p-4 border-b border-slate-800 text-gray-200;
        }
        .console-table tbody tr:hover {
            @apply bg-slate-700/50;
        }

        /* Modal Background Blur */
        .modal-backdrop {
            backdrop-filter: blur(8px);
        }
    </style>
</head>
<body id="app-root" class="min-h-screen">

    <!-- Main Content Area will be dynamically populated -->
    <div id="main-content">
        <!-- Content will be injected here by renderPage() -->
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-3"></div>

    <!-- Modal Container -->
    <div id="modal-container"></div>

    <!-- Script Block for Core Logic -->
    <script type="module">
        // --- 1. CORE IMPORTS (Firebase Modules) ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, 
            createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, doc, setDoc, collection, query, onSnapshot, deleteDoc, updateDoc, 
            addDoc, serverTimestamp, getDocs, where 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- 2. GLOBAL CONFIG & STATE ---
        
        // Mandatory Global Variables
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'polar-beacons-default';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app, db, auth;
        let authReady = false;
        let currentUser = null;
        let currentUserId = 'anonymous'; // Default ID
        let currentPath = window.location.hash.replace('#', '') || 'home';

        // Data State (Managed by onSnapshot listeners)
        let publicBeacons = [];
        let privateAlerts = [];

        const mainContentEl = document.getElementById('main-content');
        const toastContainerEl = document.getElementById('toast-container');
        const modalContainerEl = document.getElementById('modal-container');

        // Company History & Legacy Data
        const COMPANY_HISTORY = {
            founded: 1975,
            founder: "Dr. Magnus Arcturus",
            headquarters: "Inuvik, Northwest Territories, Canada",
            legacy: `Founded in 1975 by pioneering Arctic researcher Dr. Magnus Arcturus, Polar Beacons has been at the forefront of polar technology and environmental monitoring for over five decades. What began as a small research outpost in Inuvik has grown into a global leader in extreme-environment data acquisition and analysis.`
        };

        // Historical Milestones
        const HISTORICAL_MILESTONES = [
            { year: 1975, title: "Foundation", description: "Established first permanent Arctic research station in Inuvik." },
            { year: 1982, title: "First Data Network", description: "Pioneered first automated weather monitoring network across Canadian Arctic." },
            { year: 1989, title: "Satellite Integration", description: "Launched revolutionary polar-orbit data relay system." },
            { year: 1995, title: "Global Expansion", description: "Opened operations in Greenland, Norway, and Antarctica." },
            { year: 2001, title: "Digital Revolution", description: "Introduced first-generation automated data processing systems." },
            { year: 2008, title: "Environmental Focus", description: "Launched comprehensive climate change monitoring initiative." },
            { year: 2015, title: "NunaNet Launch", description: "Revolutionized polar data with AI-driven NunaNet platform." },
            { year: 2020, title: "Quantum Integration", description: "Implemented quantum-secured data transmission protocols." },
            { year: 2025, title: "Global Leadership", description: "Celebrating 50 years of Arctic innovation and excellence." }
        ];

        // Awards & Recognition
        const COMPANY_AWARDS = [
            { year: 1985, title: "Arctic Innovation Excellence Award", organization: "International Polar Research Council" },
            { year: 1992, title: "Environmental Stewardship Medal", organization: "Canadian Government" },
            { year: 2000, title: "Technology Pioneer Award", organization: "World Economic Forum" },
            { year: 2008, title: "Sustainable Business Leadership", organization: "Global Climate Initiative" },
            { year: 2015, title: "Data Security Excellence", organization: "International Cybersecurity Forum" },
            { year: 2020, title: "Lifetime Achievement Award", organization: "Arctic Technology Association" },
            { year: 2024, title: "Environmental Impact Award", organization: "United Nations Climate Action" }
        ];

        // Corporate Leadership Team
        const CORPORATE_TEAM = [
            // CEO & Polar Operations Lead
            { 
                name: "Adam Aliqatuqtuq", 
                title: "Chief Executive Officer & Polar Operations Lead", 
                icon: 'briefcase', 
                joinedYear: 1975,
                previousRoles: ["Founding CEO (1975-Present)", "Chief of Arctic Operations (1975-Present)"],
                bio: "Pioneering Arctic operations visionary who founded PolarBeacons in 1975, revolutionizing remote sensing technology for extreme environments. An Inuit leader combining traditional knowledge with cutting-edge technology, personally led over 300 critical Arctic missions. Instrumental in developing the revolutionary NunaNet framework and establishing global standards for polar data acquisition. Known for hands-on leadership in high-stakes field deployments and commitment to sustainable Arctic development.",
                achievements: ["Order of Canada Recipient (2020)", "UNESCO Arctic Heritage Award (2015)", "Lifetime Achievement Award - Polar Technology (2023)", "25+ Patents in Extreme Environment Technologies", "Founded First Indigenous-Led Tech Multinational"],
                education: "Ph.D. in Environmental Engineering, MIT (1973); Traditional Knowledge Elder, Inuit Circumpolar Council",
                imagePlaceholder: 'https://placehold.co/100x100/06b6d4/ffffff?text=CEO' 
            },
            { 
                name: "Dr. Elara Vance", 
                title: "Chief Technology Officer (CTO)", 
                icon: 'chip', 
                joinedYear: 2012,
                previousRoles: ["Lead Systems Architect (2012-2015)", "Director of Innovation (2015-2018)"],
                bio: "Pioneering technologist and architect of the NunaNet framework, specializing in secure, low-latency satellite mesh networking and edge computing for extreme environments. Led the development of our quantum-secured data transmission protocols and AI-driven predictive analytics systems.",
                achievements: ["Developed NunaNet Core Architecture", "15+ Patents in Polar Technology", "IEEE Fellow"],
                education: "Ph.D. in Quantum Computing, Stanford University",
                imagePlaceholder: 'https://placehold.co/100x100/1e293b/f8fafc?text=CTO' 
            },
            { 
                name: "Liam Chen", 
                title: "Chief Financial Officer (CFO)", 
                icon: 'dollar-sign', 
                joinedYear: 2015,
                previousRoles: ["Global Finance Director (2015-2018)", "VP of Strategic Planning (2018-2020)"],
                bio: "Strategic financial leader with extensive experience in Arctic infrastructure investments. Orchestrated the company's successful IPO and manages our $2B annual operating budget. Pioneered innovative funding models for remote installation projects.",
                achievements: ["Structured $500M Arctic Innovation Fund", "Led successful IPO process", "Financial Innovation Award 2022"],
                education: "MBA, Harvard Business School",
                imagePlaceholder: 'https://placehold.co/100x100/1e293b/f8fafc?text=CFO' 
            },
            { 
                name: "Dr. Anya Sharma", 
                title: "Chief Scientific Officer (CSO)", 
                icon: 'flask', 
                joinedYear: 2008,
                previousRoles: ["Head of Research (2008-2015)", "Director of Environmental Studies (2015-2020)"],
                bio: "Renowned climate scientist with over 20 years of Arctic research experience. Leads our scientific initiatives and research partnerships with major universities and research institutions globally. Pioneer in permafrost monitoring technologies.",
                achievements: ["Published 100+ peer-reviewed papers", "Arctic Science Medal 2021", "Led Major UN Climate Studies"],
                education: "Ph.D. in Climatology, Cambridge University",
                imagePlaceholder: 'https://placehold.co/100x100/1e293b/f8fafc?text=CSO' 
            },
            {
                name: "Maj. (Ret.) James Morrison",
                title: "Chief Security Officer (CSO)",
                icon: 'shield',
                joinedYear: 2018,
                previousRoles: ["Military Arctic Operations Specialist", "NATO Polar Security Advisor"],
                bio: "Former Special Forces commander with extensive Arctic operations experience. Oversees physical and digital security protocols for all polar installations. Expert in extreme environment risk management and emergency response.",
                achievements: ["Designed Arctic Security Protocol", "Military Arctic Service Medal", "Led 50+ Polar Expeditions"],
                education: "M.S. in Security Studies, Georgetown University",
                imagePlaceholder: 'https://placehold.co/100x100/1e293b/f8fafc?text=SEC'
            }
        ];

        const FIELD_TEAM = [
            { name: "Kaelen Stone", title: "Lead Field Engineer, NW Passage", icon: 'wind', bio: "Veteran engineer responsible for beacon deployment and maintenance across the treacherous Northwest Passage. Expert in ice dynamics and survival.", imagePlaceholder: 'https://placehold.co/100x100/06b6d4/ffffff?text=FE-1' },
            { name: "Inuk Jørgensen", title: "Remote Sensor Technician, Greenland", icon: 'thermometer', bio: "Specialist in deep-ice drilling and thermal array installation. Focused on permafrost and glacier stability monitoring.", imagePlaceholder: 'https://placehold.co/100x100/06b6d4/ffffff?text=FE-2' },
            { name: "Sarah 'Skeeter' Lee", title: "Logistics Coordinator & Pilot", icon: 'plane', bio: "Manages all remote air and ground logistics. Ensures timely deployment and emergency extraction in severe weather conditions.", imagePlaceholder: 'https://placehold.co/100x100/06b6d4/ffffff?text=Pilot' },
            { name: "Marcus 'Ice' Holt", title: "Data Recovery Specialist", icon: 'hard-drive', bio: "Deployed for high-risk manual data retrieval and hardware recovery from compromised or inaccessible beacon locations.", imagePlaceholder: 'https://placehold.co/100x100/06b6d4/ffffff?text=DRS' },
        ];


        // --- 3. UTILITY FUNCTIONS ---

        /**
         * Converts Lucide icon name to its SVG string.
         * @param {string} iconName - Name of the icon (e.g., 'activity', 'user').
         * @param {string} className - Tailwind classes.
         * @returns {string} SVG HTML string.
         */
        const getIcon = (iconName, className = 'w-5 h-5') => {
            const icon = lucide.icons[iconName];
            if (icon) {
                const [tag, attrs, children] = icon;
                const attributes = Object.entries(attrs).map(([key, value]) => `${key}="${value}"`).join(' ');
                const childrenHtml = children.map(child => {
                    const [tag, attrs] = child;
                    const attributes = Object.entries(attrs).map(([key, value]) => `${key}="${value}"`).join(' ');
                    return `<${tag} ${attributes}></${tag}>`;
                }).join('');
                return `<svg ${attributes} class="${className}">${childrenHtml}</svg>`;
            }
            return `<div class="${className}">?</div>`;
        };

        /**
         * Custom Toast Notification System (Replaces alert())
         * @param {string} message - The message to display.
         * @param {string} type - 'success', 'error', 'info', 'warning'.
         */
        const showToast = (message, type = 'info') => {
            const id = Date.now();
            const colors = {
                success: 'bg-green-600 border-green-400',
                error: 'bg-red-600 border-red-400',
                info: 'bg-cyan-600 border-cyan-400',
                warning: 'bg-yellow-600 border-yellow-400'
            };

            const toastEl = document.createElement('div');
            toastEl.id = `toast-${id}`;
            toastEl.className = `p-4 rounded-lg shadow-2xl text-white border-l-4 transition-opacity duration-300 opacity-95 pointer-events-auto max-w-sm ${colors[type]}`;
            toastEl.innerHTML = `<p class="font-semibold">${type.charAt(0).toUpperCase() + type.slice(1)}:</p><p class="text-sm">${message}</p>`;

            toastContainerEl.prepend(toastEl);

            // Auto-hide after 4 seconds
            setTimeout(() => {
                toastEl.classList.add('opacity-0');
                toastEl.addEventListener('transitionend', () => toastEl.remove());
            }, 4000);
        };

        /**
         * Utility to manage Firestore paths based on public/private rules.
         * @param {string} collectionName - Name of the specific collection.
         * @param {boolean} isPublic - True for public/shared data.
         * @returns {string} The full Firestore collection path.
         */
        const getFirestorePath = (collectionName, isPublic) => {
            if (isPublic) {
                // Public path: /artifacts/{appId}/public/data/{collectionName}
                return `artifacts/${appId}/public/data/${collectionName}`;
            } else {
                // Private path: /artifacts/{appId}/users/{userId}/{collectionName}
                return `artifacts/${appId}/users/${currentUserId}/${collectionName}`;
            }
        };

        /**
         * Firestore Real-time Listener (onSnapshot) setup.
         * @param {string} collectionName - Name of the collection.
         * @param {boolean} isPublic - Is it a public collection?
         * @param {function} callback - Function to update local state (e.g., publicBeacons = data).
         * @param {Array} conditions - Optional array of [field, operator, value] for where clauses.
         */
        const setupFirestoreListener = (collectionName, isPublic, callback, conditions = []) => {
            if (!authReady || !db) return;

            const path = getFirestorePath(collectionName, isPublic);
            const colRef = collection(db, path);
            let q = query(colRef);

            if (conditions.length > 0) {
                try {
                    const wheres = conditions.map(c => where(c[0], c[1], c[2]));
                    q = query(colRef, ...wheres);
                } catch (e) {
                    console.error("Invalid Firestore query condition:", e);
                    showToast("Error applying query conditions.", 'error');
                    return;
                }
            }

            const unsubscribe = onSnapshot(q, (snapshot) => {
                const items = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data(),
                    timestamp: doc.data().timestamp ? doc.data().timestamp.toDate().toLocaleString() : 'N/A' // Convert Firestore Timestamp
                }));
                callback(items);
                // Force re-render the current console page if data changes
                if (currentPath === 'console') {
                    renderPage(currentPath);
                }
            }, (err) => {
                console.error("Firestore listen error:", err);
                showToast(`Data stream failed for ${collectionName}. ${err.message}`, 'error');
            });

            // Return the unsubscribe function
            return unsubscribe;
        };


        // --- 4. FIREBASE INITIALIZATION & AUTHENTICATION ---

        const initializeFirebase = async () => {
            if (Object.keys(firebaseConfig).length === 0) {
                showToast("Firebase configuration is missing. Running in local/mock mode.", 'warning');
                authReady = true;
                return;
            }

            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Initial Authentication
                const authenticate = async () => {
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }
                };
                await authenticate();

                // Auth State Change Listener
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        currentUser = user;
                        currentUserId = user.uid;
                        if (!user.isAnonymous) {
                            showToast(`Welcome back, Client ${user.uid.substring(0, 8)}...`, 'success');
                        }
                    } else {
                        currentUser = null;
                        currentUserId = crypto.randomUUID();
                        showToast("Signed out. Using anonymous session.", 'info');
                    }
                    authReady = true;
                    // Initial render after auth is ready
                    setupListeners();
                    renderPage(currentPath);
                });

            } catch (error) {
                console.error("Firebase Initialization Error:", error);
                showToast(`System Error: ${error.message}`, 'error');
                authReady = true;
                renderPage(currentPath);
            }
        };

        /**
         * Sets up the real-time listeners for the application data.
         */
        const setupListeners = () => {
            if (!authReady || !db) return;

            // 1. Public Beacons (Shared across all users)
            setupFirestoreListener('beacons', true, (data) => {
                publicBeacons = data.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            });

            // 2. Private Critical Alerts (Filtered to high severity)
            setupFirestoreListener('alerts', false, (data) => {
                privateAlerts = data;
            }, ['severity', '>=', 3]);
        };
        
        // --- 5. AUTH MODAL IMPLEMENTATION ---

        const openAuthModal = () => {
            if (!authReady) return showToast("System still initializing, please wait.", 'warning');

            modalContainerEl.innerHTML = `
                <div id="auth-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop bg-black bg-opacity-80 transition-opacity duration-300">
                    <div class="bg-slate-900 w-full max-w-md p-8 rounded-xl shadow-2xl border border-cyan-700/50" onclick="event.stopPropagation()">
                        <div class="flex justify-between items-center mb-6">
                            <h2 id="auth-title" class="text-2xl font-bold text-white">Client Login</h2>
                            <button id="close-modal" class="text-gray-400 hover:text-cyan-400 transition">${getIcon('x', 'w-6 h-6')}</button>
                        </div>
                        <form id="auth-form" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-1">Email Address</label>
                                <input type="email" id="auth-email" required placeholder="client@polarbeacons.com"
                                    class="w-full p-3 bg-slate-800 border border-slate-700 rounded-lg text-white focus:ring-cyan-500 focus:border-cyan-500 transition" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-1">Password</label>
                                <input type="password" id="auth-password" required placeholder="••••••••"
                                    class="w-full p-3 bg-slate-800 border border-slate-700 rounded-lg text-white focus:ring-cyan-500 focus:border-cyan-500 transition" />
                            </div>
                            <button type="submit" id="auth-submit"
                                class="w-full p-3 bg-cyan-600 text-white rounded-lg font-semibold hover:bg-cyan-700 transition duration-200 flex items-center justify-center disabled:opacity-50">
                                ${getIcon('key', 'w-5 h-5 mr-2')} <span id="auth-button-text">Sign In</span>
                            </button>
                        </form>
                        <div class="mt-6 text-center">
                            <button id="auth-toggle" class="text-sm text-cyan-400 hover:text-cyan-300 transition">
                                Need an account? Register Here
                            </button>
                        </div>
                    </div>
                </div>
            `;

            // Setup Event Listeners for the Modal
            const modalEl = document.getElementById('auth-modal');
            const formEl = document.getElementById('auth-form');
            const closeBtn = document.getElementById('close-modal');
            const toggleBtn = document.getElementById('auth-toggle');
            let isLogin = true;

            const closeModal = () => modalContainerEl.innerHTML = '';
            closeBtn.onclick = closeModal;
            modalEl.onclick = closeModal;

            toggleBtn.onclick = () => {
                isLogin = !isLogin;
                document.getElementById('auth-title').textContent = isLogin ? 'Client Login' : 'Client Registration';
                document.getElementById('auth-button-text').textContent = isLogin ? 'Sign In' : 'Sign Up';
                toggleBtn.textContent = isLogin ? "Need an account? Register Here" : "Already have an account? Sign In";
            };

            formEl.onsubmit = async (e) => {
                e.preventDefault();
                if (!auth) return showToast("Authentication services are not available.", 'error');

                const email = document.getElementById('auth-email').value;
                const password = document.getElementById('auth-password').value;
                const submitBtn = document.getElementById('auth-submit');
                submitBtn.disabled = true;
                submitBtn.innerHTML = `${getIcon('loader-2', 'w-5 h-5 mr-2 animate-spin')} Processing...`;

                try {
                    let userCredential;
                    if (isLogin) {
                        userCredential = await signInWithEmailAndPassword(auth, email, password);
                        showToast("Login successful. Accessing Console...", 'success');
                    } else {
                        userCredential = await createUserWithEmailAndPassword(auth, email, password);
                        showToast("Registration successful! Please sign in.", 'success');
                    }
                    closeModal();
                    // Navigate to console upon successful sign-in
                    if (isLogin) navigateTo('console');

                } catch (error) {
                    let message = error.message.replace(/Firebase: /g, '');
                    showToast(`Auth Failed: ${message}`, 'error');
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = `${getIcon(isLogin ? 'key' : 'user-plus', 'w-5 h-5 mr-2')} <span id="auth-button-text">${isLogin ? 'Sign In' : 'Sign Up'}</span>`;
                }
            };
        };

        const handleSignOut = async () => {
            if (!auth) return showToast("Authentication services not available.", 'warning');
            try {
                await signOut(auth);
                showToast("Successfully logged out from the Console.", 'info');
                navigateTo('home');
            } catch (error) {
                showToast(`Logout Failed: ${error.message}`, 'error');
            }
        };


        // --- 6. PAGE RENDERING AND NAVIGATION ---

        const NAV_PAGES = {
            home: { label: 'Home', icon: 'home', auth: false, action: (el) => renderHome(el) },
            solutions: { label: 'Solutions', icon: 'layers-3', auth: false, action: (el) => renderSolutions(el) },
            cases: { label: 'Case Studies', icon: 'file-text', auth: false, action: (el) => renderCases(el) },
            team: { label: 'Our Teams', icon: 'users', auth: false, action: (el) => renderTeam(el) }, // New Team Page
            contact: { label: 'Contact', icon: 'mail', auth: false, action: (el) => renderContact(el) },
            console: { label: 'Console', icon: 'gauge', auth: true, action: (el) => renderConsole(el) },
        };

        const navigateTo = (path) => {
            currentPath = path;
            window.location.hash = path;
            renderPage(path);
        };

        const renderPage = (path) => {
            // Show loading if auth isn't ready
            if (!authReady) {
                mainContentEl.innerHTML = `
                    <div class="flex items-center justify-center min-h-screen">
                        <div class="text-center text-cyan-400">
                            ${getIcon('loader-2', 'w-8 h-8 animate-spin mx-auto mb-4')}
                            <p class="text-lg font-semibold">Initializing NunaNet... Please wait.</p>
                        </div>
                    </div>
                `;
                return;
            }

            const pageData = NAV_PAGES[path] || NAV_PAGES['home'];
            let contentHtml;

            // Check for Console access
            const isAuthenticated = currentUser && !currentUser.isAnonymous;
            if (pageData.auth && !isAuthenticated) {
                renderAccessDenied();
                return;
            }
            
            // Render Header and Footer, then call page content function
            contentHtml = renderHeader(pageData.label) + 
                          `<div id="page-content" class="min-h-[calc(100vh-160px)] pt-20"></div>` + 
                          renderFooter();
            mainContentEl.innerHTML = contentHtml;

            // Attach event listeners for navigation and user actions
            setupHeaderListeners();

            // Execute page-specific content rendering
            const pageContentEl = document.getElementById('page-content');
            if (pageData.action) {
                pageData.action(pageContentEl);
            }
        };
        
        const renderAccessDenied = () => {
             mainContentEl.innerHTML = renderHeader('Console') + `
                <div class="min-h-[calc(100vh-160px)] pt-20 flex items-center justify-center p-8">
                    <div class="bg-slate-800 p-10 rounded-xl shadow-2xl border-t-4 border-red-600 max-w-lg text-center card-glow">
                        ${getIcon('lock', 'w-12 h-12 text-red-500 mx-auto mb-4')}
                        <h2 class="text-3xl font-bold text-white mb-3">Client Console Access Restricted</h2>
                        <p class="text-gray-400 mb-6">
                            This area is reserved for authenticated Polar Beacons clients. Please sign in to view real-time operational data.
                        </p>
                        <button onclick="openAuthModal()" class="px-6 py-3 bg-cyan-600 text-white font-semibold rounded-lg hover:bg-cyan-700 transition duration-200">
                            ${getIcon('key', 'w-5 h-5 mr-2 inline-block')} Client Login
                        </button>
                    </div>
                </div>
            ` + renderFooter();
            setupHeaderListeners();
        };

        const setupHeaderListeners = () => {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.onclick = (e) => {
                    e.preventDefault();
                    navigateTo(item.getAttribute('data-page'));
                };
            });
            document.getElementById('logo-link').onclick = (e) => {
                e.preventDefault();
                navigateTo('home');
            };
            const authButton = document.getElementById('auth-button');
            if (authButton) {
                authButton.onclick = authButton.getAttribute('data-action') === 'login' ? openAuthModal : handleSignOut;
            }
        };

        // --- 7. STRUCTURAL COMPONENTS (HEADER/FOOTER) ---

        const renderHeader = (currentPageLabel) => {
            const isAuthenticated = currentUser && !currentUser.isAnonymous;
            const navItemsHtml = Object.entries(NAV_PAGES).filter(([, data]) => !data.auth || isAuthenticated)
                .map(([key, data]) => `
                    <a href="#${key}" data-page="${key}" class="nav-item flex items-center px-3 py-2 rounded-lg transition duration-200 text-sm font-medium
                        ${currentPath === key ? 'bg-cyan-600/70 text-white shadow-md' : 'text-gray-300 hover:bg-slate-700 hover:text-cyan-300'}"
                    >
                        ${getIcon(data.icon, 'w-5 h-5 mr-2')} ${data.label}
                    </a>
                `).join('');

            const authButtonHtml = isAuthenticated ? `
                <button id="auth-button" data-action="logout" class="px-4 py-2 bg-red-600 text-white rounded-lg shadow-md hover:bg-red-700 transition duration-200 flex items-center text-sm">
                    ${getIcon('log-out', 'w-4 h-4 mr-1')} Logout
                </button>
            ` : `
                <button id="auth-button" data-action="login" class="px-4 py-2 bg-cyan-600 text-white rounded-lg shadow-md hover:bg-cyan-700 transition duration-200 flex items-center text-sm">
                    ${getIcon('key', 'w-4 h-4 mr-1')} Client Login
                </button>
            `;

            return `
                <header class="fixed top-0 left-0 w-full z-40 bg-slate-900/95 backdrop-blur-md shadow-lg border-b border-cyan-800/50">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="flex items-center justify-between h-20">
                            <div class="flex-shrink-0">
                                <a href="#home" id="logo-link" class="text-3xl font-extrabold text-white flex items-center hover:text-cyan-400 transition">
                                    ${getIcon('satellite', 'w-8 h-8 text-cyan-400 mr-2')}
                                    Polar<span class="text-cyan-400">Beacons</span>
                                </a>
                            </div>
                            <!-- Desktop Navigation -->
                            <div class="hidden md:flex md:items-center md:space-x-4">
                                <nav class="flex space-x-1">${navItemsHtml}</nav>
                                <div class="ml-4">${authButtonHtml}</div>
                            </div>
                            <!-- Mobile Menu Button (Omitted for simplicity and focus on desktop corporate layout, but mobile responsive classes are used) -->
                        </div>
                    </div>
                </header>
            `;
        };

        const renderFooter = () => `
            <footer class="bg-slate-950 text-white py-12 border-t border-cyan-800/50 mt-12">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
                        <div>
                            <h4 class="text-xl font-bold text-cyan-400 mb-4">PolarBeacons</h4>
                            <p class="text-sm text-gray-400 leading-relaxed">
                                Pioneering secure, real-time data connectivity for extreme environments across the globe.
                            </p>
                        </div>
                        <div>
                            <h5 class="text-lg font-semibold text-white mb-4">Quick Access</h5>
                            <ul class="space-y-2">
                                <li><a href="#solutions" class="nav-item text-gray-400 hover:text-cyan-400 transition text-sm" data-page="solutions">Solutions</a></li>
                                <li><a href="#cases" class="nav-item text-gray-400 hover:text-cyan-400 transition text-sm" data-page="cases">Case Studies</a></li>
                                <li><a href="#team" class="nav-item text-gray-400 hover:text-cyan-400 transition text-sm" data-page="team">Our Teams</a></li>
                            </ul>
                        </div>
                        <div>
                            <h5 class="text-lg font-semibold text-white mb-4">The NunaNet Advantage</h5>
                            <ul class="space-y-2">
                                <li><a href="#" class="text-gray-400 hover:text-cyan-400 transition text-sm">Secure Data Pipeline</a></li>
                                <li><a href="#" class="text-gray-400 hover:text-cyan-400 transition text-sm">Geospatial Intelligence</a></li>
                                <li><a href="#" class="text-gray-400 hover:text-cyan-400 transition text-sm">24/7 Monitoring</a></li>
                            </ul>
                        </div>
                        <div>
                            <h5 class="text-lg font-semibold text-white mb-4">Corporate Office</h5>
                            <p class="text-sm text-gray-400 flex items-center">${getIcon('map-pin', 'w-4 h-4 mr-2 text-cyan-400')} Inuvik, NT, Canada</p>
                            <p class="text-sm text-gray-400 mt-2 flex items-center">${getIcon('mail', 'w-4 h-4 mr-2 text-cyan-400')} info@polarbeacons.com</p>
                            <div class="flex space-x-4 mt-4 text-cyan-400">
                                <a href="#" title="LinkedIn">${getIcon('linkedin', 'w-5 h-5 hover:text-white transition')}</a>
                                <a href="#" title="Twitter">${getIcon('twitter', 'w-5 h-5 hover:text-white transition')}</a>
                            </div>
                        </div>
                    </div>
                    <div class="mt-10 pt-6 border-t border-slate-800 text-center">
                        <p class="text-sm text-gray-400">
                            &copy; ${new Date().getFullYear()} Polar Beacons Technologies Ltd. All rights reserved.
                        </p>
                    </div>
                </div>
            </footer>
        `;

        // --- 8. MARKETING PAGE RENDERERS ---

        const renderHome = (el) => {
            el.className = "bg-slate-900";
            el.innerHTML = `
                <!-- Hero Section -->
                <section class="relative h-[80vh] flex items-center justify-center hero-aurora overflow-hidden">
                    <div class="relative z-10 text-center max-w-5xl px-4">
                        <h1 class="text-5xl md:text-7xl font-extrabold text-white leading-tight mb-4">
                            Operational Intelligence for the <span class="text-cyan-400">Extreme</span> North.
                        </h1>
                        <p class="text-xl text-gray-300 mb-10 md:text-2xl">
                            Our proprietary NunaNet platform delivers secure, real-time IoT data streams from the world's most remote locations to your central command.
                        </p>
                        <a href="#solutions" data-page="solutions" class="nav-item px-8 py-4 bg-cyan-600 text-white text-lg font-semibold rounded-full shadow-lg hover:bg-cyan-700 transition duration-300 transform hover:scale-105 border-2 border-cyan-500">
                            View Comprehensive Solutions
                        </a>
                    </div>
                </section>

                <!-- Key Metrics & Trust Section -->
                <section class="py-16 bg-slate-800">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <h2 class="text-3xl font-bold text-white text-center mb-12">The Polar Beacons Difference</h2>
                        <div class="grid md:grid-cols-4 gap-8 text-center">
                            <div class="p-6 bg-slate-900 rounded-xl card-glow border border-slate-700">
                                ${getIcon('package', 'w-12 h-12 text-cyan-400 mx-auto mb-3')}
                                <p class="text-4xl font-extrabold text-white">1400+</p>
                                <p class="text-gray-400 text-sm mt-1">Beacons Deployed</p>
                            </div>
                            <div class="p-6 bg-slate-900 rounded-xl card-glow border border-slate-700">
                                ${getIcon('lock', 'w-12 h-12 text-cyan-400 mx-auto mb-3')}
                                <p class="text-4xl font-extrabold text-white">99.99%</p>
                                <p class="text-gray-400 text-sm mt-1">Data Reliability</p>
                            </div>
                            <div class="p-6 bg-slate-900 rounded-xl card-glow border border-slate-700">
                                ${getIcon('thermometer', 'w-12 h-12 text-cyan-400 mx-auto mb-3')}
                                <p class="text-4xl font-extrabold text-white">-60°C</p>
                                <p class="text-gray-400 text-sm mt-1">Operating Temp Limit</p>
                            </div>
                            <div class="p-6 bg-slate-900 rounded-xl card-glow border border-slate-700">
                                ${getIcon('trending-up', 'w-12 h-12 text-cyan-400 mx-auto mb-3')}
                                <p class="text-4xl font-extrabold text-white">12+ Years</p>
                                <p class="text-gray-400 text-sm mt-1">Field Experience</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Featured Testimonial -->
                <section class="py-16 bg-slate-900">
                    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="bg-slate-800 p-8 rounded-xl border-l-8 border-cyan-500 shadow-2xl">
                            <p class="text-2xl italic text-gray-300 mb-6 leading-relaxed">
                                "The seamless integration of their PolarBeacons into our remote logistics pipeline was transformative. We now predict ice movements days in advance, a critical factor in saving both time and resources."
                            </p>
                            <div class="flex items-center">
                                <div class="w-12 h-12 rounded-full bg-cyan-700 flex items-center justify-center mr-4">${getIcon('user', 'w-6 h-6 text-white')}</div>
                                <div>
                                    <p class="font-bold text-white">Dr. Lena Olen</p>
                                    <p class="text-cyan-400 text-sm">VP of Operations, Arctic Energy Group</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            `;
        };

        const renderSolutions = (el) => {
            el.className = "bg-slate-900 py-16";
            el.innerHTML = `
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <h1 class="text-5xl font-extrabold text-white mb-4 border-b-4 border-cyan-600 pb-3">Comprehensive Polar Solutions</h1>
                    <p class="text-xl text-gray-400 mb-12">
                        We provide full-stack services, from hardware deployment to predictive data intelligence.
                    </p>

                    <div class="grid md:grid-cols-3 gap-8">
                        ${renderSolutionCard('Remote IoT Sensing', 'Our hardened PolarBeacons operate autonomously in temperatures down to -60°C, transmitting vital data via redundant satellite and mesh links.', 'package')}
                        ${renderSolutionCard('Geospatial Analytics', 'Transform raw sensor data into actionable intelligence on ice thickness, permafrost stability, and maritime conditions using advanced AI models.', 'map')}
                        ${renderSolutionCard('NunaNet Secure Cloud', 'A dedicated cloud platform built for mission-critical data, featuring end-to-end encryption, geo-redundancy, and low-latency API access.', 'shield')}
                        ${renderSolutionCard('Logistics Optimization', 'Integrate NunaNet data directly into your route planning and asset tracking systems to reduce fuel consumption and increase safety.', 'compass')}
                        ${renderSolutionCard('Environmental Monitoring', 'Track long-term climate impact, ground shifts, and air quality for compliance and research initiatives.', 'cloud-rain')}
                        ${renderSolutionCard('24/7 Technical Support', 'Dedicated Arctic operations specialists provide round-the-clock monitoring and rapid-response field support.', 'activity')}
                    </div>

                    <div class="mt-16 pt-10 border-t border-slate-800">
                        <h2 class="text-3xl font-bold text-cyan-400 mb-6">Hardware Resilience</h2>
                        <p class="text-gray-400 max-w-4xl">
                            Every PolarBeacon unit is designed for survivability. Featuring kinetic charging, supercapacitors for extreme bursts, and an IP69K rating, our hardware is the most reliable choice for non-stop operations in high-latitude, remote zones.
                        </p>
                    </div>
                </div>
            `;
        };

        const renderSolutionCard = (title, description, iconName) => `
            <div class="bg-slate-800 p-6 rounded-xl shadow-lg border border-slate-700 card-glow">
                ${getIcon(iconName, 'w-10 h-10 text-cyan-400 mb-4')}
                <h3 class="text-xl font-semibold text-white mb-3">${title}</h3>
                <p class="text-gray-400">${description}</p>
            </div>
        `;

        const renderCases = (el) => {
            el.className = "bg-slate-900 py-16";
            el.innerHTML = `
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <h1 class="text-5xl font-extrabold text-white mb-4 border-b-4 border-cyan-600 pb-3">Client Success Stories</h1>
                    <p class="text-xl text-gray-400 mb-12">
                        See how organizations are leveraging NunaNet to conquer the challenges of the Arctic and Antarctic.
                    </p>

                    <div class="space-y-12">
                        ${renderCaseStudy('Project Ice-Bridge Stability', 'A major infrastructure firm needed continuous data on bridge foundation integrity due to accelerated permafrost thaw. Polar Beacons deployed deep-ground thermal arrays and micro-tilt sensors, providing predictive failure alerts and extending the lifespan of the asset by 15%.', 'map', 'Infrastructure', 'Predictive Maintenance')}
                        ${renderCaseStudy('The Polar Sea Route', 'A global shipping line required real-time ice field mapping to navigate the Northwest Passage safely. Our Iridium-linked buoys provided critical, low-latency data that resulted in a 30% reduction in transit time and eliminated two high-risk near-miss incidents.', 'ship', 'Maritime Logistics', 'Route Optimization')}
                        ${renderCaseStudy('Remote Scientific Outpost', 'A national research group needed to automate data collection from an uninhabited volcanic island. We delivered a self-sustaining network that monitors seismic activity and air quality, cutting manual data collection costs by 95%.', 'flask-conical', 'Scientific Research', 'Autonomous Data Collection')}
                    </div>
                </div>
            `;
        };

        const renderCaseStudy = (title, summary, iconName, sector, focus) => `
            <div class="bg-slate-800 p-8 rounded-xl shadow-xl flex flex-col md:flex-row border border-slate-700 card-glow">
                <div class="md:w-1/3 flex flex-col justify-between p-4 bg-slate-900 rounded-lg mr-6 mb-4 md:mb-0">
                    <div class="flex items-center text-cyan-400 mb-4">
                        ${getIcon(iconName, 'w-8 h-8 mr-3')}
                        <h2 class="text-2xl font-bold text-white">${title}</h2>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500 uppercase font-semibold">Sector / Focus</p>
                        <p class="text-lg font-medium text-cyan-300">${sector}</p>
                        <p class="text-lg font-medium text-cyan-300">${focus}</p>
                    </div>
                </div>
                <div class="md:w-2/3">
                    <p class="text-gray-300 leading-relaxed">${summary}</p>
                    <button class="mt-4 text-sm font-semibold text-cyan-400 hover:text-cyan-300 flex items-center transition">
                        Read Full Case Study ${getIcon('arrow-right', 'w-4 h-4 ml-1')}
                    </button>
                </div>
            </div>
        `;
        
        // --- NEW TEAM PAGE RENDERER ---

        const renderTeam = (el) => {
            el.className = "bg-slate-900 py-16";
            el.innerHTML = `
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <h1 class="text-5xl font-extrabold text-white mb-4 border-b-4 border-cyan-600 pb-3">${getIcon('users', 'w-10 h-10 inline-block mr-3 text-cyan-400')} Meet Our Operational Teams</h1>
                    <p class="text-xl text-gray-400 mb-12">
                        Expertise is deployed globally, from our executive command center to the furthest reach of the Arctic Circle.
                    </p>

                    <!-- Corporate Leadership Section -->
                    <h2 class="text-4xl font-bold text-cyan-400 mb-8 mt-12 border-b border-slate-700 pb-3">${getIcon('briefcase', 'w-8 h-8 inline-block mr-3')} Corporate Leadership</h2>
                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
                        ${CORPORATE_TEAM.map(member => renderTeamMember(member, member.name.includes('CEO'))).join('')}
                    </div>

                    <!-- Field Operations Section -->
                    <h2 class="text-4xl font-bold text-cyan-400 mb-8 mt-16 border-b border-slate-700 pb-3">${getIcon('wind', 'w-8 h-8 inline-block mr-3')} Field Operations Team</h2>
                    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
                        ${FIELD_TEAM.map(member => renderTeamMember(member, false)).join('')}
                    </div>
                </div>
            `;
        };

        const renderTeamMember = (member, isPrimary) => `
            <div class="bg-slate-800 p-6 rounded-xl shadow-xl border ${isPrimary ? 'border-cyan-500' : 'border-slate-700'} card-glow ${isPrimary ? 'lg:col-span-2 md:col-span-2' : ''}">
                <div class="flex ${isPrimary ? 'items-start space-x-6' : 'items-center space-x-4'}">
                    <img src="${member.imagePlaceholder}" alt="${member.name}" class="rounded-full ${isPrimary ? 'w-24 h-24' : 'w-16 h-16'} object-cover border-4 border-cyan-600 flex-shrink-0" onerror="this.onerror=null;this.src='${member.imagePlaceholder}'"/>
                    <div>
                        <h3 class="text-xl font-bold text-white ${isPrimary ? 'text-2xl text-cyan-400' : ''}">${member.name.replace('You (', '').replace(')', '')}</h3>
                        <p class="text-sm ${isPrimary ? 'text-white font-semibold mt-1' : 'text-cyan-300'}">${member.title}</p>
                    </div>
                </div>
                <p class="text-gray-400 mt-4 text-sm ${isPrimary ? 'pt-4 border-t border-slate-700' : ''}">
                    ${member.bio}
                </p>
                <div class="mt-4 flex space-x-3 text-gray-500">
                    ${getIcon('linkedin', 'w-5 h-5 hover:text-cyan-400 transition')}
                    ${getIcon('mail', 'w-5 h-5 hover:text-cyan-400 transition')}
                </div>
            </div>
        `;


        const renderContact = (el) => {
            el.className = "bg-slate-900 py-16";
            el.innerHTML = `
                <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                    <h1 class="text-5xl font-extrabold text-white mb-4 border-b-4 border-cyan-600 pb-3 text-center">Contact Our Specialists</h1>
                    <p class="text-xl text-gray-400 mb-12 text-center">
                        Our team is available 24/7 for critical support and new project consultations.
                    </p>

                    <div class="grid md:grid-cols-2 gap-8">
                        <!-- Contact Form -->
                        <div class="bg-slate-800 p-8 rounded-xl shadow-lg border border-slate-700">
                            <h2 class="text-2xl font-bold text-white mb-4">Inquiry Form</h2>
                            <form id="contact-form" class="space-y-4">
                                <div>
                                    <input type="text" name="name" required placeholder="Your Full Name" class="w-full p-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:ring-cyan-500 focus:border-cyan-500" />
                                </div>
                                <div>
                                    <input type="email" name="email" required placeholder="Work Email Address" class="w-full p-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:ring-cyan-500 focus:border-cyan-500" />
                                </div>
                                <div>
                                    <select name="subject" required class="w-full p-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:ring-cyan-500 focus:border-cyan-500 appearance-none">
                                        <option value="" disabled selected>Select Inquiry Type</option>
                                        <option value="Sales">New Project / Sales</option>
                                        <option value="Support">Technical Support</option>
                                        <option value="Careers">Careers</option>
                                    </select>
                                </div>
                                <div>
                                    <textarea name="message" rows="5" required placeholder="Your Message or Project Brief..." class="w-full p-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:ring-cyan-500 focus:border-cyan-500"></textarea>
                                </div>
                                <button type="submit" id="contact-submit-btn"
                                    class="w-full p-3 bg-cyan-600 text-white rounded-lg font-semibold hover:bg-cyan-700 transition duration-200 flex items-center justify-center">
                                    ${getIcon('send', 'w-5 h-5 mr-2')} Send Inquiry
                                </button>
                            </form>
                        </div>

                        <!-- Contact Details -->
                        <div class="space-y-6">
                            ${renderContactDetail('24/7 Technical Support', 'support@polarbeacons.com', getIcon('activity', 'w-6 h-6 text-cyan-400'))}
                            ${renderContactDetail('Sales & Consulting', 'sales@polarbeacons.com', getIcon('dollar-sign', 'w-6 h-6 text-cyan-400'))}
                            ${renderContactDetail('Headquarters', '201 Arctic Way, Inuvik, NT X0E 0T0, Canada', getIcon('map-pin', 'w-6 h-6 text-cyan-400'))}
                        </div>
                    </div>
                </div>
            `;

            // Attach form submission handler
            document.getElementById('contact-form').onsubmit = (e) => {
                e.preventDefault();
                const btn = document.getElementById('contact-submit-btn');
                btn.disabled = true;
                btn.innerHTML = `${getIcon('loader-2', 'w-5 h-5 mr-2 animate-spin')} Submitting...`;

                // Simulate form submission success
                setTimeout(() => {
                    showToast("Your corporate inquiry has been sent successfully. We'll be in touch!", 'success');
                    e.target.reset();
                    btn.disabled = false;
                    btn.innerHTML = `${getIcon('send', 'w-5 h-5 mr-2')} Send Inquiry`;
                }, 1500);
            };
        };

        const renderContactDetail = (title, detail, iconHtml) => `
            <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 flex items-start space-x-4">
                <div class="flex-shrink-0">${iconHtml}</div>
                <div>
                    <p class="text-lg font-semibold text-white">${title}</p>
                    <p class="text-gray-400">${detail}</p>
                </div>
            </div>
        `;


        // --- 9. SECURE CONSOLE RENDERER ---

        const renderConsole = (el) => {
            el.className = "bg-slate-950 py-16 min-h-screen";
            el.innerHTML = `
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <h1 class="text-5xl font-extrabold text-white mb-2">${getIcon('gauge', 'w-10 h-10 inline-block mr-3 text-cyan-400')} NunaNet Client Console</h1>
                    <p class="text-lg text-gray-400 mb-8 border-b border-slate-800 pb-4">
                        User ID: <span class="text-cyan-400 font-mono text-sm">${currentUserId}</span> | Real-time operational command center.
                    </p>

                    <!-- Console Statistics -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                        ${renderStatCard('Data Throughput (Last 7d)', '3.45 TB', '8.5% Up', 'trending-up', 'text-green-400')}
                        ${renderStatCard('Active Beacon Count', publicBeacons.length, '0% Change', 'package', 'text-cyan-400')}
                        ${renderStatCard('Avg Network Latency', '210 ms', '1.2% Down', 'zap', 'text-red-400')}
                        ${renderStatCard('Critical Alerts (24h)', privateAlerts.length, '', 'alert-triangle', privateAlerts.length > 0 ? 'text-yellow-400' : 'text-gray-500')}
                    </div>

                    <!-- Beacon Management Table -->
                    <div class="bg-slate-800 p-6 rounded-xl shadow-2xl border border-slate-700 mb-12">
                        <h2 class="text-2xl font-bold text-cyan-400 mb-4 flex justify-between items-center">
                            ${getIcon('package', 'w-6 h-6 mr-2')} Deployed PolarBeacons (Public Data)
                            <button id="add-beacon-btn" class="px-3 py-1.5 bg-cyan-600 text-white rounded-lg shadow-md hover:bg-cyan-700 transition duration-200 flex items-center text-sm">
                                ${getIcon('plus', 'w-4 h-4 mr-1')} Deploy Mock
                            </button>
                        </h2>
                        ${renderBeaconTable()}
                    </div>

                    <!-- Critical Alerts Panel -->
                    <div class="bg-slate-800 p-6 rounded-xl shadow-2xl border border-slate-700">
                        <h2 class="text-2xl font-bold text-yellow-400 mb-4 flex items-center">
                            ${getIcon('alert-triangle', 'w-6 h-6 mr-2')} Critical System Alerts (Private Data)
                        </h2>
                        ${renderAlertsPanel()}
                    </div>
                </div>
            `;

            // Attach Console Listeners
            document.getElementById('add-beacon-btn').onclick = handleAddBeacon;
            document.querySelectorAll('.delete-beacon-btn').forEach(btn => {
                btn.onclick = () => handleDeleteBeacon(btn.dataset.id);
            });
        };

        const renderStatCard = (title, value, change, iconName, colorClass) => `
            <div class="bg-slate-800 p-6 rounded-xl shadow-lg border border-slate-700 card-glow">
                <div class="flex items-center justify-between">
                    ${getIcon(iconName, `w-8 h-8 ${colorClass}`)}
                    <span class="text-sm font-medium ${change.includes('Up') ? 'text-green-400' : change.includes('Down') ? 'text-red-400' : 'text-gray-400'}">
                        ${change}
                    </span>
                </div>
                <p class="text-lg text-gray-400 mt-3">${title}</p>
                <div class="text-3xl font-bold text-white mt-1">
                    ${value}
                </div>
            </div>
        `;

        const renderBeaconTable = () => {
            if (publicBeacons.length === 0) {
                return `<p class="p-4 text-center text-gray-500">No active beacons found. Click 'Deploy Mock' to add a unit.</p>`;
            }
            
            const rows = publicBeacons.map(beacon => `
                <tr class="transition duration-150">
                    <td class="p-4">${beacon.id.substring(0, 6)}...</td>
                    <td class="p-4 font-semibold text-cyan-300">${beacon.location || 'N/A'}</td>
                    <td class="p-4">${beacon.status === 'Active' ? `<span class="text-green-400 flex items-center">${getIcon('check-circle', 'w-4 h-4 mr-1')} Active</span>` : `<span class="text-red-400 flex items-center">${getIcon('alert-octagon', 'w-4 h-4 mr-1')} Critical</span>`}</td>
                    <td class="p-4 font-mono">${beacon.temperature} °C</td>
                    <td class="p-4 text-sm">${beacon.battery}%</td>
                    <td class="p-4 text-sm">${beacon.timestamp}</td>
                    <td class="p-4">
                        <button data-id="${beacon.id}" class="delete-beacon-btn text-red-400 hover:text-red-600 transition">
                            ${getIcon('trash-2', 'w-5 h-5')}
                        </button>
                    </td>
                </tr>
            `).join('');

            return `
                <div class="overflow-x-auto rounded-lg border border-slate-700">
                    <table class="console-table min-w-full table-auto text-left text-gray-200">
                        <thead class="bg-slate-700/50">
                            <tr>
                                <th>ID</th>
                                <th>Location</th>
                                <th>Status</th>
                                <th>Temperature</th>
                                <th>Battery</th>
                                <th>Last Check</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>${rows}</tbody>
                    </table>
                </div>
            `;
        };
        
        const renderAlertsPanel = () => {
            if (privateAlerts.length === 0) {
                return `<p class="p-4 text-center text-gray-500">No critical alerts currently active in your private feed.</p>`;
            }
            
            const alertRows = privateAlerts.map(alert => `
                <div class="p-4 bg-slate-900 rounded-lg border-l-4 border-yellow-500 mb-3 hover:shadow-lg transition">
                    <div class="flex justify-between items-center">
                        <p class="font-bold text-lg text-white">${alert.type}: ${alert.location}</p>
                        <span class="text-xs font-mono text-gray-500">${alert.timestamp}</span>
                    </div>
                    <p class="text-sm text-gray-400 mt-1">${alert.message}</p>
                    <p class="text-xs text-red-400 font-semibold mt-2">Severity Level: ${alert.severity}</p>
                </div>
            `).join('');
            
            return alertRows;
        };


        // --- 10. CONSOLE DATA HANDLERS (CRUD) ---

        const handleAddBeacon = async () => {
            if (!db) return showToast("DB not initialized.", 'error');

            const locations = ["Beaufort Sea Sector", "Greenland Ice Sheet E-04", "Hudson Bay Post", "Alert Station"];
            const location = locations[Math.floor(Math.random() * locations.length)];
            const temp = (Math.random() * -35 - 5).toFixed(1); // -5.0 to -40.0 C
            const status = Math.random() < 0.9 ? 'Active' : 'Critical';

            try {
                const newBeacon = {
                    location: location,
                    status: status,
                    temperature: temp,
                    battery: Math.floor(Math.random() * 10) + 90,
                    deployedBy: currentUserId.substring(0, 8),
                    timestamp: serverTimestamp(),
                };
                const path = getFirestorePath('beacons', true);
                // Use addDoc to automatically generate a document ID
                await addDoc(collection(db, path), newBeacon);
                showToast(`New Beacon deployed at ${location}.`, 'success');
            } catch (error) {
                console.error("Error adding beacon:", error);
                showToast(`Failed to add beacon: ${error.message}`, 'error');
            }
        };

        const handleDeleteBeacon = async (id) => {
            if (!db) return showToast("DB not initialized.", 'error');

            // Use modal for confirmation instead of alert/confirm
            modalContainerEl.innerHTML = `
                <div class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop bg-black bg-opacity-80">
                    <div class="bg-slate-900 w-full max-w-sm p-6 rounded-xl shadow-2xl border-t-4 border-red-600" onclick="event.stopPropagation()">
                        <h2 class="text-xl font-bold text-white mb-4">Confirm Deletion</h2>
                        <p class="text-gray-400 mb-6">Are you sure you want to permanently decommission beacon ID ${id.substring(0, 6)}...?</p>
                        <div class="flex justify-end space-x-3">
                            <button id="cancel-delete" class="px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition">Cancel</button>
                            <button id="confirm-delete" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">Confirm Decommission</button>
                        </div>
                    </div>
                </div>
            `;
            const closeModal = () => modalContainerEl.innerHTML = '';
            document.getElementById('cancel-delete').onclick = closeModal;
            document.getElementById('confirm-delete').onclick = async () => {
                closeModal();
                try {
                    const path = getFirestorePath('beacons', true);
                    await deleteDoc(doc(db, path, id));
                    showToast(`Beacon ${id.substring(0, 6)}... decommissioned.`, 'success');
                } catch (error) {
                    console.error("Error deleting beacon:", error);
                    showToast(`Failed to decommission beacon: ${error.message}`, 'error');
                }
            };
        };


        // --- 11. INITIAL EXECUTION ---
        window.onload = () => {
            // Start Firebase initialization and auth listener
            initializeFirebase();

            // Set up hash change listener for navigation
            window.addEventListener('hashchange', () => {
                const newPath = window.location.hash.replace('#', '') || 'home';
                if (newPath !== currentPath) {
                    navigateTo(newPath);
                }
            });

            // Initial render (will show loading screen until authReady is true)
            renderPage(currentPath);
        };
    </script>
</body>
</html>